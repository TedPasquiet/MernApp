"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_tracking_blocks_tracking-block-api_ts"],{17063:(e,t,n)=>{let i;n.d(t,{Z:()=>P});var a=n(45974),r=n(86207),o=n(89445),s=n(59753),l=n(58700);function c(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t){return t.get?t.get.call(e):t.value}function d(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=n}}function h(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function p(e,t){var n=h(e,t,"get");return u(e,n)}function m(e,t,n){c(e,t),t.set(e,n)}function f(e,t,n){var i=h(e,t,"set");return d(e,i,n),n}function b(e,t,n){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return n}function y(e,t){c(e,t),t.add(e)}let w=Object.freeze({Accept:"application/json","X-Requested-With":"XMLHttpRequest"}),v=(e,t)=>{let n=a.dy`<input type="hidden" hidden />`.template.content,i=n.firstChild;return i.setAttribute("name",e),i.setAttribute("value",t),i},k=(e,t)=>{let n=[],i=document.createDocumentFragment();for(let e in t){if(!t.hasOwnProperty(e))continue;let a=e,r=v(a,t[a]).cloneNode(!0);n.push(r),i.appendChild(r)}e.appendChild(i);let a=new FormData(e);for(let e of n)e.remove();return a},_=e=>{let t=document.createElement("div");t.innerHTML=e;let n=document.createDocumentFragment();return n.replaceChildren(...t.children),n},g=Promise.resolve();var T=new WeakMap,E=new WeakMap,S=new WeakMap,M=new WeakMap,A=new WeakSet,C=new WeakSet,L=new WeakSet,q=new WeakSet,j=new WeakSet,D=new WeakSet,H=new WeakSet;let P=class TrackingBlockAPIComponent{get canSync(){return p(this,T)&&(!p(this,S)||!!p(this,M))}init(e=!1,t=!1){return p(this,T)||(f(this,M,p(this,S)?.querySelector("[data-form-tracking-block-update]")??null),f(this,T,!0),this.uiToMDEnabled=e,this.uiToMDMemexEnabled=t),this}async addDraftItem(e){let t=await b(this,A,R).call(this,{...e,operation:"add"});if(!t)return null;let n=t.body,i=t.hierarchy_completion,a=_(t.tracking_block_items);return{body:n,completion:i,fragment:a}}async appendDraftItem(e){return await b(this,C,I).call(this,e)}async updateDraftItemTitleMD(e){return await b(this,C,I).call(this,e)}async updateDraftItemStateMD(e){return await b(this,C,I).call(this,e)}async removeItemMD(e){return await b(this,C,I).call(this,e)}async removeTasklistBlock(e){return await b(this,C,I).call(this,e)}async addTasklistBlock(e){return await b(this,C,I).call(this,e)}async convertToIssueMD(e){return await b(this,C,I).call(this,e)}async updateTasklistTitle(e){return await b(this,C,I).call(this,e)}async convertDraftItem(e){let t=await b(this,A,R).call(this,{...e,operation:"convert_to_issue"});if(!t)return null;let n=t.body,i=t.hierarchy_completion,a=_(t.tracking_block_items);return{body:n,completion:i,fragment:a}}async removeItem(e){let t=await b(this,A,R).call(this,{...e,operation:"remove"});if(!t)return null;let n=t.body,i=t.hierarchy_completion;return{body:n,completion:i}}async updateDraftItem(e){let t=await b(this,A,R).call(this,{...e,operation:"update_draft_issue"});if(!t)return null;let n=t.body,i=t.hierarchy_completion,a=_(t.tracking_block_items);return{body:n,completion:i,fragment:a}}async updateItemPositionMD(e){return await b(this,C,I).call(this,e)}async updateItemPosition(e){let t=await b(this,A,R).call(this,{...e,operation:"update_issue_position"});if(!t)return null;let n=t.body,i=_(t.tracking_block_items);return{body:n,fragment:i}}dispatchEvent(e){return p(this,E).dispatchEvent(e)}async refreshTasklistBlocks(e){p(this,E).classList.add("is-dirty"),this.dispatchEvent(new CustomEvent("tracking-block:dirty-change",{bubbles:!0})),await this.queueMDAtRestRequest(e)}async queueMDAtRestRequest(e,t){document.body.removeAttribute("data-turbo"),window.clearTimeout(i),i=void 0;let n=()=>b(this,q,F).call(this,e,t);return g=g.then(n,n)}disableCommentElements(e){b(this,j,x).call(this,e),b(this,D,N).call(this,e),b(this,H,O).call(this,e)}constructor(e,t){y(this,A),y(this,C),y(this,L),y(this,q),y(this,j),y(this,D),y(this,H),m(this,T,{writable:!0,value:!1}),m(this,E,{writable:!0,value:void 0}),m(this,S,{writable:!0,value:void 0}),m(this,M,{writable:!0,value:null}),f(this,E,e),f(this,S,t)}};async function R(e){if(!this.canSync)return null;let t=p(this,M),n=k(t,e),i=t.getAttribute("action");if(!i)return null;let a=await (0,o.Q)(i,{method:t.method,body:n,headers:{...w}});if(!a.ok)return null;try{let e=await a.json(),{redirectUrl:t}=e;if(t?.length>0){window.location=t;return}return e}catch(e){return null}}async function I(e){this.disableCommentElements(!0);try{return await b(this,L,W).call(this,e)}finally{this.disableCommentElements(!1)}}async function W(e){let{formId:t,...n}=e,a=!1,o=!t;if(p(this,E).classList.add("is-dirty"),this.dispatchEvent(new CustomEvent("tracking-block:dirty-change",{bubbles:!0})),!this.uiToMDEnabled||o&&!this.uiToMDMemexEnabled)return await b(this,q,F).call(this,t,JSON.stringify(n));if(o)a=await new Promise((t,n)=>{let i=new CustomEvent("tracking-block:operation",{bubbles:!0,detail:{payload:e,resolve:t,reject:n}});this.dispatchEvent(i)});else{let i=document.querySelector(`form#${t}`),o=i?.querySelector(".js-comment-field"),s=o?.value;if(s){let t=await (0,r.fp)(s,e);null!=t&&(o.value=t,a=!0)}if(i){let e=i.querySelector('input[name="tasklist_blocks_operation_tracker"]'),t={name:n.operation};if("append_item"===n.operation&&(t.value=n.value),e){let n=e.getAttribute("value");try{let i=JSON.parse(n);i.push(t),e.setAttribute("value",JSON.stringify(i))}catch(e){}}else{let e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","tasklist_blocks_operation_tracker"),e.setAttribute("value",JSON.stringify([t])),i.appendChild(e)}}}if(p(this,S)?.handleStateChange("unsaved-changes"),!a)return await this.queueMDAtRestRequest(t,JSON.stringify(n));let l=async()=>{let{activeElement:e}=document,t=p(this,E),n=null!=e?.closest(".js-tracking-block-omnibar-container");if(t?.querySelector(".js-tasklist-dragging")||t?.querySelector(".js-edit-metadata-popover-container:not([hidden])")||(n?e.value:t?.contains(e))){i=window.setTimeout(l,200);return}await c()},c=async()=>{(0,s.S)("click","a[href], .js-comment-edit-button",c),window.clearTimeout(i),i=window.setTimeout(async()=>{try{await this.queueMDAtRestRequest(t)}catch(e){console.error(e)}finally{window.removeEventListener("beforeunload",u)}},0)},u=e=>{i&&(c(),e.preventDefault(),e.returnValue="Please wait a second while we save your changes.")};window.addEventListener("beforeunload",u,{once:!0}),(0,s.on)("click","a[href], .js-comment-edit-button",c),window.clearTimeout(i),i=window.setTimeout(l,2e3),document.body.setAttribute("data-turbo","false")}async function F(e,t){if(!this.canSync)return null;p(this,S)?.handleStateChange("saving"),p(this,E).classList.remove("is-dirty");try{if(e){let n=document.querySelector(`form#${e}`);if(!n)return null;let i=n.querySelectorAll('input[name="tasklist_blocks_operation"]'),a=n.querySelectorAll('input[name="tasklist_blocks_operation_tracker"]');for(let e of i)e.remove();if(t){let e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","tasklist_blocks_operation"),e.setAttribute("value",t),n.appendChild(e)}n.setAttribute("data-submitting-tracking-block-update",t?"sync":"async"),await new Promise((e,t)=>{let i=i=>{n.removeAttribute("data-submitting-tracking-block-update");let{detail:a}=i;a.error?t(a.error):e()};n.addEventListener("submit:complete",i,{once:!0});try{for(let e of((0,l.Bt)(n),a))e.remove()}catch(e){n.removeEventListener("submit:complete",i),t(e)}})}else await new Promise((e,n)=>{let i=new CustomEvent("tracking-block:update",{bubbles:!0,cancelable:!0,detail:{payload:t,resolve:e,reject:n}}),a=this.dispatchEvent(i);a&&e()})}catch(e){throw p(this,S)?.handleStateChange("failed-save"),e}this.dispatchEvent(new CustomEvent("tracking-block:dirty-change",{bubbles:!0})),p(this,S)?.handleStateChange("successful-save")}function x(e){let t=p(this,E).querySelectorAll("button, details.dropdown, .js-item-avatar-stack, .js-label-assignee-container");for(let n of t)n.toggleAttribute("disabled",e)}function N(e){let t=p(this,E).querySelectorAll('tracking-block-omnibar, [data-targets="tracking-block.inputs"]');for(let n of t)n.disabled=e}function O(e){let t=p(this,E).querySelectorAll("tracking-block");for(let n of t)n.sortable?.option("disabled",e)}},58700:(e,t,n)=>{n.d(t,{Bt:()=>r,DN:()=>l,KL:()=>d,Se:()=>s,qC:()=>h,sw:()=>c});var i=n(5582);function a(e,t,n){return e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:n}))}function r(e,t){t&&(o(e,t),(0,i.j)(t)),a(e,"submit",!0)&&e.submit()}function o(e,t){if(!(e instanceof HTMLFormElement))throw TypeError("The specified element is not of type HTMLFormElement.");if(!(t instanceof HTMLElement))throw TypeError("The specified element is not of type HTMLElement.");if("submit"!==t.type)throw TypeError("The specified element is not a submit button.");if(!e||e!==t.form)throw Error("The specified element is not owned by the form element.")}function s(e,t){if("boolean"==typeof t){if(e instanceof HTMLInputElement)e.checked=t;else throw TypeError("only checkboxes can be set to boolean value")}else{if("checkbox"===e.type)throw TypeError("checkbox can't be set to string value");e.value=t}a(e,"change",!1)}function l(e,t){for(let n in t){let i=t[n],a=e.elements.namedItem(n);a instanceof HTMLInputElement?a.value=i:a instanceof HTMLTextAreaElement&&(a.value=i)}}function c(e){if(!(e instanceof HTMLElement))return!1;let t=e.nodeName.toLowerCase(),n=(e.getAttribute("type")||"").toLowerCase();return"select"===t||"textarea"===t||"input"===t&&"submit"!==n&&"reset"!==n||e.isContentEditable}function u(e){return new URLSearchParams(e)}function d(e,t){let n=new URLSearchParams(e.search),i=u(t);for(let[e,t]of i)n.append(e,t);return n.toString()}function h(e){return u(new FormData(e)).toString()}},5582:(e,t,n)=>{function i(e){let t=e.closest("form");if(!(t instanceof HTMLFormElement))return;let n=a(t);if(e.name){let i=e.matches("input[type=submit]")?"Submit":"",a=e.value||i;n||((n=document.createElement("input")).type="hidden",n.classList.add("js-submit-button-value"),t.prepend(n)),n.name=e.name,n.value=a}else n&&n.remove()}function a(e){let t=e.querySelector("input.js-submit-button-value");return t instanceof HTMLInputElement?t:null}n.d(t,{j:()=>i,u:()=>a})},45974:(e,t,n)=>{n.d(t,{dy:()=>r.dy,sY:()=>r.sY,Au:()=>r.Au});var i=n(22490);let a=i.Z.createPolicy("jtml-no-op",{createHTML:e=>e});var r=n(20845);r.js.setCSPTrustedTypesPolicy(a)},86283:(e,t,n)=>{n.d(t,{Qg:()=>i.Qg,W6:()=>i.W6,cF:()=>i.cF,iG:()=>a.iG,jX:()=>a.jX,n4:()=>a.n4,zu:()=>a.zu});var i=n(35647),a=n(73614)},73614:(e,t,n)=>{n.d(t,{iG:()=>a,jX:()=>o,n4:()=>i,zu:()=>r});let i="undefined"==typeof document?void 0:document,a="undefined"==typeof window?void 0:window,r="undefined"==typeof history?void 0:history,o="undefined"==typeof location?{pathname:"",origin:"",search:"",hash:""}:location},35647:(e,t,n)=>{n.d(t,{Qg:()=>r,W6:()=>a,cF:()=>o});var i=n(73614);let a=void 0===i.n4,r=!a;function o(){return!!a||Boolean(i.n4.querySelector('react-app[data-ssr="true"]'))}},86207:(e,t,n)=>{async function i(e,t){let{appendItem:i,removeItem:a,removeTasklistBlock:r,updateItemPosition:o,updateItemState:s,updateItemTitle:l,updateTasklistTitle:c}=await Promise.all([n.e("vendors-node_modules_micromark_index_js-node_modules_remark-gfm_index_js-node_modules_remark_-2e1650"),n.e("ui_packages_tasklist-block-operations_operations_ts")]).then(n.bind(n,46473));if("append_item"===t.operation){if(!/^\s*(https?:|#)/.test(t.value))return i(e,t.position,t.value)}else if("update_item_title"===t.operation)return l(e,t.position,t.value);else if("update_item_state"===t.operation)return s(e,t.position,t.closed);else if("update_item_position"===t.operation)return o(e,t.src,t.dst);else if("remove_item"===t.operation)return a(e,t.position);else if("remove_tasklist_block"===t.operation)return r(e,t.position);else if("update_tasklist_title"===t.operation)return c(e,t.position,t.name);return null}async function a(e){let{transformToHTML:t}=await Promise.all([n.e("vendors-node_modules_micromark_index_js-node_modules_remark-gfm_index_js-node_modules_remark_-2e1650"),n.e("ui_packages_tasklist-block-operations_operations_ts")]).then(n.bind(n,46473));return t(e)}function r(e){return"append_item"===e.operation}n.d(t,{C9:()=>r,cK:()=>a,fp:()=>i})},22490:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(86283);function a(e){return()=>{throw TypeError(`The policy does not implement the function ${e}`)}}let r={createHTML:a("createHTML"),createScript:a("createScript"),createScriptURL:a("createScriptURL")},o={createPolicy:(e,t)=>({name:e,...r,...t})},s=globalThis.trustedTypes??o,l=!1;i.n4?.addEventListener("securitypolicyviolation",e=>{"require-trusted-types-for"!==e.violatedDirective||l||(console.warn(`Hi fellow Hubber!
    You're probably seeing a Report Only Trusted Types error near this message. This is intended behaviour, staff-only,
    does not impact application control flow, and is used solely for statistic collection. Unfortunately we
    can't gather these statistics without adding the above warnings to your console. Sorry about that!
    Feel free to drop by #pse-architecture if you have any additional questions about Trusted Types or CSP.`),l=!0)})},89445:(e,t,n)=>{function i(e,t={}){if(e.match(/^https?:/))throw Error("Can not make cross-origin requests from verifiedFetch");let n={...t.headers,"GitHub-Verified-Fetch":"true","X-Requested-With":"XMLHttpRequest"};return fetch(e,{...t,headers:n})}function a(e,t){let n=t?.headers??{},a={...n,Accept:"application/json","Content-Type":"application/json"},r=t?.body?JSON.stringify(t.body):void 0;return i(e,{...t,body:r,headers:a})}n.d(t,{Q:()=>i,v:()=>a})}}]);
//# sourceMappingURL=app_components_tracking_blocks_tracking-block-api_ts-cf64647113f2.js.map